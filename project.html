<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mozillio - Project Management</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Reset and Global Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #0056ff;
  --primary-dark: #0046d4;
  --primary-light: #e8efff;
  --sidebar-width: 280px;
  --sidebar-collapsed-width: 80px;
  --white: #ffffff;
  --gray-50: #f9fafb;
  --gray-100: #f3f4f6;
  --gray-200: #e5e7eb;
  --gray-500: #6b7280;
  --gray-700: #374151;
  --gray-900: #111827;
  --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --radius: 12px;
}

body {
  font-family: 'Inter', 'Segoe UI', Tahoma, sans-serif;
  background: #f0f4f8;
  color: var(--gray-900);
  line-height: 1.6;
  overflow-x: hidden;
}

/* ------------------ Layout ------------------ */
.layout {
  display: flex;
  min-height: 100vh;
}

/* ------------------ Modern Sidebar ------------------ */
.sidebar {
  width: var(--sidebar-width);
  background: var(--white);
  border-right: 1px solid var(--gray-200);
  box-shadow: var(--shadow);
  padding: 25px 20px;
  display: flex;
  flex-direction: column;
  position: fixed;
  height: 100vh;
  overflow-y: auto;
  z-index: 100;
  transition: all 0.3s ease;
}

.sidebar-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 40px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--gray-200);
}

.sidebar-logo {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  background: var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  overflow: hidden;
}

.sidebar-logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sidebar h3 {
  font-size: 22px;
  font-weight: 700;
  color: var(--primary);
  transition: opacity 0.3s ease;
}

.menu {
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex: 1;
}

.menu-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 14px 18px;
  text-decoration: none;
  color: var(--gray-700);
  font-size: 16px;
  border-radius: var(--radius);
  transition: all 0.3s ease;
  position: relative;
  cursor: pointer;
}

.menu-item:hover {
  background: var(--primary-light);
  color: var(--primary);
  transform: translateX(5px);
}

.menu-item.active {
  background: var(--primary);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 86, 255, 0.2);
}

.menu-item i {
  font-size: 20px;
  width: 24px;
  text-align: center;
}

.menu-text {
  transition: opacity 0.3s ease;
}

.menu-badge {
  position: absolute;
  right: 15px;
  background: var(--primary);
  color: white;
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 20px;
}

/* Dropdown Menu */
.dropdown-menu {
  display: none;
  flex-direction: column;
  gap: 4px;
  margin-left: 30px;
  margin-top: 8px;
  padding-left: 15px;
  border-left: 2px solid var(--gray-200);
}

.dropdown-menu.active {
  display: flex;
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 15px;
  text-decoration: none;
  color: var(--gray-600);
  font-size: 14px;
  border-radius: var(--radius);
  transition: all 0.3s ease;
}

.dropdown-item:hover {
  background: var(--gray-100);
  color: var(--primary);
}

.dropdown-item.active {
  background: var(--primary-light);
  color: var(--primary);
  font-weight: 500;
}

.dropdown-item i {
  font-size: 16px;
  width: 20px;
}

/* Sidebar Footer */
.sidebar-footer {
  margin-top: auto;
  padding-top: 20px;
  border-top: 1px solid var(--gray-200);
}

.footer-links {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.footer-link {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 15px;
  text-decoration: none;
  color: var(--gray-500);
  font-size: 14px;
  border-radius: var(--radius);
  transition: all 0.3s ease;
}

.footer-link:hover {
  background: var(--gray-100);
  color: var(--gray-700);
}

.footer-link i {
  font-size: 16px;
  width: 20px;
  text-align: center;
}

/* Sidebar Toggle Button for Mobile - Only shows on mobile */
.sidebar-toggle {
  display: none;
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 8px;
  width: 40px;
  height: 40px;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--shadow);
}

/* ------------------ Main Content ------------------ */
.main-content {
  flex: 1;
  margin-left: var(--sidebar-width);
  padding: 0;
  transition: all 0.3s ease;
  background: #f8fafc;
}

/* ------------------ Top Header ------------------ */
.top-header {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  padding: 25px 40px;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 20px rgba(0, 86, 255, 0.15);
}

.header-left h1 {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.welcome-text {
  font-size: 16px;
  opacity: 0.9;
  display: flex;
  align-items: center;
  gap: 8px;
}

.welcome-icon {
  background: rgba(255, 255, 255, 0.2);
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 25px;
}

.header-icons {
  display: flex;
  gap: 15px;
}

.icon-button {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.icon-button:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.notification-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #ff6b6b;
  color: white;
  font-size: 10px;
  font-weight: 600;
  padding: 3px 7px;
  border-radius: 10px;
  min-width: 18px;
  text-align: center;
  border: 2px solid var(--primary);
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 20px;
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.3s ease;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.user-menu:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-1px);
}

.user-menu-avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.user-menu-info {
  display: flex;
  flex-direction: column;
}

.user-menu-name {
  font-weight: 600;
  font-size: 15px;
  color: white;
}

.user-menu-role {
  font-size: 13px;
  opacity: 0.8;
  color: white;
}

/* ------------------ Container ------------------ */
.container {
  max-width: 1200px;
  margin: 40px auto;
  background: var(--white);
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.08);
  padding: 40px;
  border: 1px solid var(--gray-200);
}

/* ------------------ Page Header ------------------ */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding-bottom: 20px;
  border-bottom: 2px solid var(--gray-200);
}

.page-title {
  font-size: 28px;
  font-weight: 700;
  color: var(--gray-900);
  display: flex;
  align-items: center;
  gap: 12px;
}

.page-title i {
  color: var(--primary);
  font-size: 24px;
}

/* ------------------ Action Bar ------------------ */
.action-bar {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: 30px;
  gap: 15px;
}

.search-box {
  flex: 1;
  max-width: 400px;
  position: relative;
}

.search-box input {
  width: 100%;
  padding: 12px 45px 12px 16px;
  border: 1px solid var(--gray-200);
  border-radius: var(--radius);
  font-size: 14px;
  background: var(--white);
}

.search-box i {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray-500);
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: var(--radius);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
}

.btn-primary {
  background: var(--primary);
  color: white;
  box-shadow: 0 4px 15px rgba(0, 86, 255, 0.2);
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 86, 255, 0.3);
}

.btn-secondary {
  background: var(--gray-100);
  color: var(--gray-700);
  border: 1px solid var(--gray-200);
}

.btn-secondary:hover {
  background: var(--gray-200);
  transform: translateY(-1px);
}

/* ------------------ Data Table ------------------ */
.data-table-container {
  background: var(--white);
  border-radius: var(--radius);
  border: 1px solid var(--gray-200);
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.data-table {
  width: 100%;
  border-collapse: collapse;
}

.data-table th {
  background: var(--gray-50);
  padding: 16px;
  text-align: left;
  font-weight: 600;
  color: var(--gray-700);
  border-bottom: 1px solid var(--gray-200);
  font-size: 14px;
}

.data-table td {
  padding: 16px;
  border-bottom: 1px solid var(--gray-200);
  font-size: 14px;
}

.data-table tr:hover {
  background: var(--gray-50);
}

.data-table tr:last-child td {
  border-bottom: none;
}

.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
}

.status-draft {
  background: #fef3c7;
  color: #d97706;
}

.status-sent {
  background: #dbeafe;
  color: #1d4ed8;
}

.status-paid {
  background: #dcfce7;
  color: #15803d;
}

.status-active {
  background: #dcfce7;
  color: #15803d;
}

.status-completed {
  background: #dbeafe;
  color: #1d4ed8;
}

.status-onhold {
  background: #fef3c7;
  color: #d97706;
}

.status-delayed {
  background: #fee2e2;
  color: #dc2626;
}

.action-buttons {
  display: flex;
  gap: 8px;
}

.btn-sm {
  padding: 8px 12px;
  font-size: 12px;
  border-radius: 8px;
}

.btn-edit {
  background: #e0f2fe;
  color: #0369a1;
  border: 1px solid #bae6fd;
}

.btn-delete {
  background: #fee2e2;
  color: #dc2626;
  border: 1px solid #fecaca;
}

.btn-view {
  background: #f0f9ff;
  color: #0c4a6e;
  border: 1px solid #bae6fd;
}

.btn-edit:hover, .btn-delete:hover, .btn-view:hover {
  transform: translateY(-1px);
}

/* ------------------ Project Form Styles ------------------ */
.header-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
  padding-bottom: 25px;
  border-bottom: 2px solid var(--gray-200);
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 20px;
}

.logo {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(0, 86, 255, 0.2);
}

.logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.header-text {
  display: flex;
  flex-direction: column;
}

.header-text h2 {
  text-align: left;
  color: var(--primary);
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
}

.project-number {
  font-size: 16px;
  font-weight: 600;
  color: var(--gray-500);
  background: var(--gray-100);
  padding: 6px 12px;
  border-radius: 20px;
  display: inline-block;
}

.form-section {
  margin-bottom: 40px;
}

.section-title {
  font-weight: 700;
  font-size: 20px;
  color: var(--gray-900);
  margin: 40px 0 20px 0;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--gray-200);
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title i {
  color: var(--primary);
}

.box-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  margin-bottom: 30px;
}

.box {
  background: var(--gray-50);
  border-radius: var(--radius);
  padding: 25px;
  border: 1px solid var(--gray-200);
  transition: all 0.3s ease;
}

.box:hover {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.box-title {
  font-weight: 600;
  margin-bottom: 20px;
  color: var(--primary);
  font-size: 18px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.box-title i {
  font-size: 16px;
}

.input-group {
  margin-bottom: 20px;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--gray-700);
  font-size: 14px;
}

input, textarea, select {
  width: 100%;
  padding: 15px 18px;
  border-radius: var(--radius);
  border: 1px solid var(--gray-200);
  font-size: 15px;
  font-family: inherit;
  transition: all 0.3s ease;
  background: var(--white);
}

input:focus, textarea:focus, select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(0, 86, 255, 0.15);
  outline: none;
  background: var(--white);
}

/* ------------------ Project Managers Section ------------------ */
.project-managers-section {
  background: var(--gray-50);
  border-radius: var(--radius);
  padding: 25px;
  border: 1px solid var(--gray-200);
  margin-bottom: 30px;
}

.manager-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.manager-item {
  background: var(--white);
  border-radius: var(--radius);
  padding: 15px;
  border: 1px solid var(--gray-200);
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.3s ease;
}

.manager-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.manager-item.assigned {
  background: var(--primary-light);
  border-color: var(--primary);
}

.manager-item.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.manager-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 14px;
}

.manager-info {
  flex: 1;
}

.manager-name {
  font-weight: 600;
  color: var(--gray-900);
  font-size: 14px;
}

.manager-role {
  font-size: 12px;
  color: var(--gray-500);
}

.manager-assigned {
  font-size: 10px;
  background: #dcfce7;
  color: #15803d;
  padding: 3px 8px;
  border-radius: 12px;
}

/* ------------------ Timeline Section ------------------ */
.timeline-section {
  margin-top: 20px;
}

.timeline-dates {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 30px;
}

.timeline-item {
  display: flex;
  flex-direction: column;
}

.timeline-item label {
  font-weight: 500;
  color: var(--gray-700);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.timeline-calendar {
  background: var(--white);
  border-radius: var(--radius);
  padding: 20px;
  border: 1px solid var(--gray-200);
  text-align: center;
}

.calendar-header {
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.calendar-days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
  margin-top: 15px;
}

.calendar-day {
  padding: 8px;
  border-radius: 8px;
  text-align: center;
  font-size: 12px;
}

.calendar-day.weekday {
  font-weight: 600;
  color: var(--gray-700);
  background: var(--gray-100);
}

.calendar-day.active {
  background: var(--primary);
  color: white;
}

/* ------------------ Progress Section ------------------ */
.progress-section {
  margin: 30px 0;
}

.progress-bar-container {
  background: var(--gray-200);
  height: 12px;
  border-radius: 6px;
  overflow: hidden;
  margin: 15px 0;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
  border-radius: 6px;
  transition: width 0.3s ease;
}

.progress-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
}

/* ------------------ Page Navigation ------------------ */
.page-content {
  display: none;
}

.page-content.active {
  display: block;
}

/* ------------------ Modal Styles ------------------ */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background-color: white;
  padding: 24px;
  border-radius: 8px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--gray-200);
}

.modal-header h2 {
  color: #0f172a;
  font-size: 20px;
  font-weight: 600;
}

.close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #64748b;
}

.delete-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 24px;
}

.confirm-delete-btn {
  background-color: #ef4444;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.2s;
}

.confirm-delete-btn:hover {
  background-color: #dc2626;
}

.cancel-btn {
  background-color: #e2e8f0;
  color: #475569;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.2s;
}

.cancel-btn:hover {
  background-color: #cbd5e1;
}

/* ------------------ Mobile Responsiveness ------------------ */
@media (max-width: 1024px) {
  .box-container {
    grid-template-columns: 1fr;
  }
  
  .container {
    padding: 30px;
    margin: 30px;
  }
  
  .sidebar {
    width: var(--sidebar-collapsed-width);
  }
  
  .sidebar h3,
  .menu-text,
  .menu-badge,
  .dropdown-menu {
    opacity: 0;
    visibility: hidden;
  }
  
  .main-content {
    margin-left: var(--sidebar-collapsed-width);
  }
  
  .sidebar-header {
    justify-content: center;
  }
  
  .footer-link span {
    display: none;
  }
  
  .manager-list {
    grid-template-columns: 1fr;
  }
  
  .timeline-dates {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .sidebar-toggle {
    display: flex;
  }
  
  .sidebar {
    transform: translateX(-100%);
    width: var(--sidebar-width);
  }
  
  .sidebar.active {
    transform: translateX(0);
  }
  
  .sidebar h3,
  .menu-text,
  .menu-badge,
  .dropdown-menu {
    opacity: 1;
    visibility: visible;
  }
  
  .main-content {
    margin-left: 0;
    padding: 0;
  }
  
  .container {
    padding: 20px;
    margin: 20px;
    border-radius: 15px;
  }
  
  .top-header {
    padding: 20px;
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }
  
  .header-right {
    width: 100%;
    justify-content: space-between;
  }
  
  .page-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 20px;
  }
  
  .action-bar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-box {
    max-width: 100%;
  }
  
  .user-menu-info {
    display: none;
  }
  
  .footer-link span {
    display: block;
  }
}

@media (max-width: 576px) {
  .container {
    padding: 15px;
    margin: 15px;
    border-radius: 12px;
  }
  
  .data-table {
    font-size: 12px;
  }
  
  .data-table th,
  .data-table td {
    padding: 12px 8px;
  }
  
  .action-buttons {
    flex-direction: column;
    gap: 4px;
  }
}

/* Overlay for mobile sidebar */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 99;
  display: none;
}

.sidebar-overlay.active {
  display: block;
}

/* Non-functional page styling */
.non-functional {
  text-align: center;
  padding: 60px 20px;
  color: var(--gray-500);
}

.non-functional i {
  font-size: 48px;
  margin-bottom: 20px;
  display: block;
}

.non-functional h3 {
  margin-bottom: 10px;
}

.non-functional p {
  margin-bottom: 20px;
}
</style>
</head>

<body>

<!-- Sidebar Toggle Button for Mobile - Only shows on mobile -->
<button class="sidebar-toggle" id="sidebarToggle">
  <i class="fas fa-bars"></i>
</button>

<!-- Sidebar Overlay for Mobile -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Delete Confirmation Modal -->
<div class="modal delete-modal" id="deleteModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Delete Project</h2>
      <button class="close-btn" id="closeDeleteModal">&times;</button>
    </div>
    <p>Are you sure you want to delete this project? This action cannot be undone.</p>
    <div class="delete-actions">
      <button class="cancel-btn" id="cancelDelete">Cancel</button>
      <button class="confirm-delete-btn" id="confirmDelete">Delete</button>
    </div>
  </div>
</div>

<div class="layout">
  <!-- Modern Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <img src="c:\Users\mozil\Downloads\moz logo (1).png" alt="Mozillio Logo">
      </div>
      <h3>Mozillio</h3>
    </div>

    <nav class="menu">
      <!-- Dashboard -->
      <a href="#" class="menu-item non-functional-link" data-page="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span class="menu-text">Dashboard</span>
      </a>
      
      <!-- Sales Dropdown -->
      <div class="menu-item" id="salesMenu">
        <i class="fas fa-shopping-cart"></i>
        <span class="menu-text">Sales</span>
        <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 12px;"></i>
      </div>
      
      <div class="dropdown-menu" id="salesDropdown">
        <a href="invoices.html" class="dropdown-item" data-page="invoices">
          <i class="fas fa-file-invoice"></i>
          <span>Invoices</span>
        </a>
        <a href="client.html" class="dropdown-item" data-page="clients">
          <i class="fas fa-users"></i>
          <span>Clients</span>
        </a>
      </div>
      
      <!-- Projects -->
      <a href="#" class="menu-item active" data-page="projects">
        <i class="fas fa-project-diagram"></i>
        <span class="menu-text">Projects</span>
      </a>
      <a href="#" class="menu-item non-functional-link" data-page="calendar">
        <i class="fas fa-calendar"></i>
        <span class="menu-text">Calendar</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="footer-links">
        <a href="#" class="footer-link">
          <i class="fas fa-shield-alt"></i>
          <span>Privacy Policy</span>
        </a>
        <a href="#" class="footer-link">
          <i class="fas fa-file-contract"></i>
          <span>Terms of Service</span>
        </a>
        <a href="#" class="footer-link">
          <i class="fas fa-question-circle"></i>
          <span>Help & Support</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Header -->
    <div class="top-header">
      <div class="header-left">
        <h1 id="pageTitle">Projects</h1>
        <div class="welcome-text">
          <span class="welcome-icon">ðŸ‘‹</span>
          Welcome back, Alex Morgan!
        </div>
      </div>
      <div class="header-right">
        <div class="header-icons">
          <div class="icon-button">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
          </div>
          <div class="icon-button">
            <i class="fas fa-envelope"></i>
            <span class="notification-badge">5</span>
          </div>
          <div class="icon-button">
            <i class="fas fa-cog"></i>
          </div>
        </div>
        <div class="user-menu">
          <div class="user-menu-avatar">
            AM
          </div>
          <div class="user-menu-info">
            <div class="user-menu-name">Alex Morgan</div>
            <div class="user-menu-role">Administrator</div>
          </div>
          <i class="fas fa-chevron-down"></i>
        </div>
      </div>
    </div>

    <!-- Projects List Page -->
    <div class="container page-content active" id="projectsPage">
      <div class="page-header">
        <div class="page-title">
          <i class="fas fa-project-diagram"></i>
          Projects
        </div>
        <button class="btn btn-primary" id="createProjectBtn">
          <i class="fas fa-plus"></i>
          Create Project
        </button>
      </div>

      <div class="action-bar">
        <div class="search-box">
          <input type="text" placeholder="Search projects...">
          <i class="fas fa-search"></i>
        </div>
        <button class="btn btn-secondary">
          <i class="fas fa-filter"></i>
          Filter
        </button>
        <button class="btn btn-secondary">
          <i class="fas fa-download"></i>
          Export
        </button>
      </div>

      <div class="data-table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Project ID</th>
              <th>Project Name</th>
              <th>Client</th>
              <th>Start Date</th>
              <th>Due Date</th>
              <th>Progress</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="projectsTableBody">
            <!-- Projects will be loaded here -->
            <tr>
              <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray-500);">
                <i class="fas fa-project-diagram" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                <p>No projects found. <a href="#" style="color: var(--primary);" id="createFirstProject">Create your first project</a></p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Create/Edit Project Page -->
    <div class="container page-content" id="createProjectPage">
      <!-- Header with logo and project number -->
      <div class="header-section">
        <div class="logo-container">
          <div class="logo">
            <img src="c:\Users\mozil\Downloads\moz logo (1).png" alt="Mozillio Logo">
          </div>
          <div class="header-text">
            <h2 id="projectFormTitle">Create New Project</h2>
            <div class="project-number" id="projectNumberDisplay">PROJ-001</div>
          </div>
        </div>
        <button class="btn btn-secondary" id="backToProjects">
          <i class="fas fa-arrow-left"></i>
          Back to Projects
        </button>
      </div>

      <form id="projectForm">
        <!-- Project and Client Details in Boxes -->
        <div class="box-container">
          <div class="box">
            <div class="box-title">
              <i class="fas fa-clipboard-check"></i>
              Project Details
            </div>
            <div class="input-group">
              <label for="projectName"><i class="fas fa-tasks"></i> Project Name</label>
              <input type="text" id="projectName" name="projectName" placeholder="Enter project name" required>
            </div>
            <div class="input-group">
              <label for="projectType"><i class="fas fa-tag"></i> Project Type</label>
              <select id="projectType" name="projectType" required>
                <option value="">Select project type</option>
                <option value="web">Web Development</option>
                <option value="mobile">Mobile App</option>
                <option value="design">UI/UX Design</option>
                <option value="marketing">Digital Marketing</option>
                <option value="consulting">Consulting</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="input-group">
              <label for="projectDescription"><i class="fas fa-align-left"></i> Project Description</label>
              <textarea id="projectDescription" name="projectDescription" placeholder="Describe the project..." rows="4" required></textarea>
            </div>
          </div>

          <div class="box">
            <div class="box-title">
              <i class="fas fa-building"></i>
              Company & Client Details
            </div>
            <div class="input-group">
              <label for="companyName"><i class="fas fa-building"></i> Company Name</label>
              <select id="companyName" name="companyName" required>
                <option value="">Select company</option>
                <option value="mozilla">Mozilla Corporation</option>
                <option value="google">Google LLC</option>
                <option value="microsoft">Microsoft Corporation</option>
                <option value="apple">Apple Inc.</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="input-group">
              <label for="clientName"><i class="fas fa-user"></i> Client Name</label>
              <input type="text" id="clientName" name="clientName" placeholder="Client contact person" required>
            </div>
            <div class="input-group">
              <label for="clientEmail"><i class="fas fa-envelope"></i> Client Email</label>
              <input type="email" id="clientEmail" name="clientEmail" placeholder="client@company.com" required>
            </div>
            <div class="input-group">
              <label for="clientPhone"><i class="fas fa-phone"></i> Client Phone</label>
              <input type="tel" id="clientPhone" name="clientPhone" placeholder="+1 (555) 123-4567">
            </div>
          </div>
        </div>

        <!-- Project Timeline Section -->
        <div class="section-title">
          <i class="fas fa-calendar-alt"></i>
          Project Timeline
        </div>
        
        <div class="box timeline-section">
          <div class="timeline-dates">
            <div class="timeline-item">
              <label for="startDate"><i class="fas fa-play-circle"></i> Start Date</label>
              <input type="date" id="startDate" name="startDate" required>
            </div>
            <div class="timeline-item">
              <label for="dueDate"><i class="fas fa-flag-checkered"></i> Due Date</label>
              <input type="date" id="dueDate" name="dueDate" required>
            </div>
          </div>
          
          <div class="timeline-calendar">
            <div class="calendar-header">
              <i class="fas fa-calendar-week"></i>
              Project Timeline
            </div>
            <div id="calendarPreview">
              <!-- Calendar will be generated here -->
              <p style="color: var(--gray-500); text-align: center;">Select dates to view timeline</p>
            </div>
          </div>
        </div>

        <!-- Project Managers Assignment -->
        <div class="section-title">
          <i class="fas fa-users-cog"></i>
          Project Managers
        </div>
        
        <div class="project-managers-section">
          <div class="input-group">
            <label><i class="fas fa-search"></i> Assign Project Managers</label>
            <p style="color: var(--gray-500); margin-bottom: 15px; font-size: 14px;">Select project managers from the list below. Already assigned managers will be marked.</p>
          </div>
          
          <div class="manager-list" id="managerList">
            <!-- Managers will be loaded here -->
            <div class="manager-item" data-manager-id="1">
              <div class="manager-avatar">AM</div>
              <div class="manager-info">
                <div class="manager-name">Alex Morgan</div>
                <div class="manager-role">Senior Project Manager</div>
              </div>
              <div class="manager-assigned">Available</div>
            </div>
            <div class="manager-item" data-manager-id="2">
              <div class="manager-avatar">JS</div>
              <div class="manager-info">
                <div class="manager-name">John Smith</div>
                <div class="manager-role">Technical Lead</div>
              </div>
              <div class="manager-assigned">Available</div>
            </div>
            <div class="manager-item assigned" data-manager-id="3">
              <div class="manager-avatar">SD</div>
              <div class="manager-info">
                <div class="manager-name">Sarah Davis</div>
                <div class="manager-role">Product Manager</div>
              </div>
              <div class="manager-assigned">Assigned</div>
            </div>
            <div class="manager-item" data-manager-id="4">
              <div class="manager-avatar">MJ</div>
              <div class="manager-info">
                <div class="manager-name">Mike Johnson</div>
                <div class="manager-role">Delivery Manager</div>
              </div>
              <div class="manager-assigned">Available</div>
            </div>
          </div>
          
          <input type="hidden" id="assignedManagers" name="assignedManagers">
        </div>

        <!-- Progress Tracking -->
        <div class="section-title">
          <i class="fas fa-chart-line"></i>
          Progress Tracking
        </div>
        
        <div class="box progress-section">
          <div class="input-group">
            <label for="projectProgress"><i class="fas fa-percentage"></i> Project Progress (%)</label>
            <input type="range" id="projectProgress" name="projectProgress" min="0" max="100" value="0" step="5">
            <div class="progress-info">
              <span>0%</span>
              <span id="progressValue">0%</span>
              <span>100%</span>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
          </div>
          
          <div class="input-group">
            <label for="projectStatus"><i class="fas fa-check-circle"></i> Project Status</label>
            <select id="projectStatus" name="projectStatus">
              <option value="active">Active</option>
              <option value="planning">Planning</option>
              <option value="in-progress">In Progress</option>
              <option value="on-hold">On Hold</option>
              <option value="completed">Completed</option>
              <option value="delayed">Delayed</option>
            </select>
          </div>
        </div>

        <!-- Budget & Milestones -->
        <div class="section-title">
          <i class="fas fa-money-check-alt"></i>
          Budget & Milestones
        </div>
        
        <div class="box">
          <div class="input-group">
            <label for="projectBudget"><i class="fas fa-dollar-sign"></i> Project Budget (RM)</label>
            <input type="number" id="projectBudget" name="projectBudget" min="0" step="1000" placeholder="Enter project budget">
          </div>
          <div class="input-group">
            <label for="milestones"><i class="fas fa-flag"></i> Key Milestones</label>
            <textarea id="milestones" name="milestones" placeholder="List key project milestones separated by commas..." rows="3"></textarea>
          </div>
          <div class="input-group">
            <label for="projectNotes"><i class="fas fa-sticky-note"></i> Additional Notes</label>
            <textarea id="projectNotes" name="projectNotes" placeholder="Any additional notes or requirements..." rows="3"></textarea>
          </div>
        </div>

        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px;">
          <button type="submit" id="saveProjectBtn" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Project
          </button>
          <button type="button" class="btn btn-secondary" id="cancelProject">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Airtable config for Projects
const AIRTABLE_BASE_ID = "app6jM5rj5GDbVvCI";
const AIRTABLE_API_KEY = "patPDSUOPn8u7HTNY.94a90bce28105c224fb2b46b5029fb17fc85daa91b5a0126ec2358637727fbe4";
const AIRTABLE_PROJECTS_TABLE = "Projects";

// Sample project managers data
const projectManagers = [
  { id: 1, name: "Alex Morgan", role: "Senior Project Manager", avatar: "AM", assigned: false },
  { id: 2, name: "John Smith", role: "Technical Lead", avatar: "JS", assigned: false },
  { id: 3, name: "Sarah Davis", role: "Product Manager", avatar: "SD", assigned: true },
  { id: 4, name: "Mike Johnson", role: "Delivery Manager", avatar: "MJ", assigned: false },
  { id: 5, name: "Emma Wilson", role: "Scrum Master", avatar: "EW", assigned: false },
  { id: 6, name: "David Brown", role: "QA Manager", avatar: "DB", assigned: false }
];

// Page Management
document.addEventListener('DOMContentLoaded', function() {
  const sidebar = document.getElementById('sidebar');
  const sidebarToggle = document.getElementById('sidebarToggle');
  const sidebarOverlay = document.getElementById('sidebarOverlay');
  const salesMenu = document.getElementById('salesMenu');
  const salesDropdown = document.getElementById('salesDropdown');
  const pageTitle = document.getElementById('pageTitle');
  const createProjectBtn = document.getElementById('createProjectBtn');
  const backToProjects = document.getElementById('backToProjects');
  const createFirstProject = document.getElementById('createFirstProject');
  const cancelProject = document.getElementById('cancelProject');
  const deleteModal = document.getElementById('deleteModal');
  const closeDeleteModal = document.getElementById('closeDeleteModal');
  const cancelDelete = document.getElementById('cancelDelete');
  const confirmDelete = document.getElementById('confirmDelete');
  const projectFormTitle = document.getElementById('projectFormTitle');
  const saveProjectBtn = document.getElementById('saveProjectBtn');

  // Variables to track current state
  let currentProjectId = null;
  let isEditMode = false;
  let currentProjectNumber = '';
  let selectedManagers = [];

  // Toggle sidebar on button click
  sidebarToggle.addEventListener('click', function() {
    sidebar.classList.toggle('active');
    sidebarOverlay.classList.toggle('active');
  });
  
  // Close sidebar when clicking on overlay
  sidebarOverlay.addEventListener('click', function() {
    sidebar.classList.remove('active');
    sidebarOverlay.classList.remove('active');
  });

  // Toggle sales dropdown
  salesMenu.addEventListener('click', function(e) {
    e.preventDefault();
    salesDropdown.classList.toggle('active');
    salesMenu.querySelector('.fa-chevron-down').classList.toggle('fa-chevron-up');
  });

  // Page navigation
  function navigateToPage(pageId, pageName) {
    // Hide all pages
    document.querySelectorAll('.page-content').forEach(page => {
      page.classList.remove('active');
    });
    
    // Show selected page
    document.getElementById(pageId).classList.add('active');
    
    // Update page title
    pageTitle.textContent = pageName;
    
    // Close sidebar on mobile
    if (window.innerWidth <= 768) {
      sidebar.classList.remove('active');
      sidebarOverlay.classList.remove('active');
    }

    // Load data if navigating to projects page
    if (pageId === 'projectsPage') {
      loadProjectsFromAirtable();
    }
  }

  // Set up page navigation for projects
  document.querySelectorAll('[data-page="projects"]').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const pageId = this.getAttribute('data-page') + 'Page';
      const pageName = this.querySelector('span').textContent;
      navigateToPage(pageId, pageName);
      
      // Set active states
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelectorAll('.dropdown-item').forEach(item => {
        item.classList.remove('active');
      });
      
      this.classList.add('active');
    });
  });

  // Set up page navigation for other pages
  document.querySelectorAll('.non-functional-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const pageId = this.getAttribute('data-page') + 'Page';
      const pageName = this.querySelector('span').textContent;
      navigateToPage(pageId, pageName);
      
      // Set active states
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelectorAll('.dropdown-item').forEach(item => {
        item.classList.remove('active');
      });
      
      this.classList.add('active');
    });
  });

  // Create project navigation
  createProjectBtn.addEventListener('click', function() {
    resetProjectForm();
    projectFormTitle.textContent = 'Create New Project';
    saveProjectBtn.innerHTML = '<i class="fas fa-save"></i> Save Project';
    isEditMode = false;
    navigateToPage('createProjectPage', 'Create Project');
  });

  createFirstProject.addEventListener('click', function(e) {
    e.preventDefault();
    resetProjectForm();
    projectFormTitle.textContent = 'Create New Project';
    saveProjectBtn.innerHTML = '<i class="fas fa-save"></i> Save Project';
    isEditMode = false;
    navigateToPage('createProjectPage', 'Create Project');
  });

  backToProjects.addEventListener('click', function() {
    navigateToPage('projectsPage', 'Projects');
  });

  cancelProject.addEventListener('click', function() {
    navigateToPage('projectsPage', 'Projects');
  });

  // Initialize project managers
  function initializeManagers() {
    const managerList = document.getElementById('managerList');
    managerList.innerHTML = '';
    
    projectManagers.forEach(manager => {
      const managerItem = document.createElement('div');
      managerItem.className = `manager-item ${manager.assigned ? 'assigned' : ''}`;
      managerItem.setAttribute('data-manager-id', manager.id);
      
      managerItem.innerHTML = `
        <div class="manager-avatar">${manager.avatar}</div>
        <div class="manager-info">
          <div class="manager-name">${manager.name}</div>
          <div class="manager-role">${manager.role}</div>
        </div>
        <div class="manager-assigned">${manager.assigned ? 'Assigned' : 'Available'}</div>
      `;
      
      // Only allow clicking if not already assigned
      if (!manager.assigned) {
        managerItem.addEventListener('click', function() {
          const managerId = this.getAttribute('data-manager-id');
          const manager = projectManagers.find(m => m.id == managerId);
          
          if (manager) {
            const isSelected = this.classList.contains('selected');
            
            if (isSelected) {
              // Remove from selection
              this.classList.remove('selected');
              selectedManagers = selectedManagers.filter(id => id != managerId);
            } else {
              // Add to selection
              this.classList.add('selected');
              selectedManagers.push(managerId);
            }
            
            // Update hidden input
            document.getElementById('assignedManagers').value = selectedManagers.join(',');
          }
        });
      } else {
        managerItem.classList.add('disabled');
        managerItem.style.cursor = 'not-allowed';
      }
      
      managerList.appendChild(managerItem);
    });
  }

  // Progress bar update
  const progressSlider = document.getElementById('projectProgress');
  const progressValue = document.getElementById('progressValue');
  const progressBar = document.getElementById('progressBar');
  
  progressSlider.addEventListener('input', function() {
    const value = this.value;
    progressValue.textContent = value + '%';
    progressBar.style.width = value + '%';
  });

  // Calendar preview for dates
  const startDateInput = document.getElementById('startDate');
  const dueDateInput = document.getElementById('dueDate');
  const calendarPreview = document.getElementById('calendarPreview');
  
  function updateCalendarPreview() {
    const startDate = startDateInput.value;
    const dueDate = dueDateInput.value;
    
    if (!startDate || !dueDate) {
      calendarPreview.innerHTML = '<p style="color: var(--gray-500); text-align: center;">Select dates to view timeline</p>';
      return;
    }
    
    const start = new Date(startDate);
    const due = new Date(dueDate);
    const diffTime = Math.abs(due - start);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    // Simple calendar display
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const startMonth = months[start.getMonth()];
    const dueMonth = months[due.getMonth()];
    
    calendarPreview.innerHTML = `
      <div style="margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--gray-700);">
          <div><strong>Start:</strong> ${startMonth} ${start.getDate()}, ${start.getFullYear()}</div>
          <div><strong>Due:</strong> ${dueMonth} ${due.getDate()}, ${due.getFullYear()}</div>
        </div>
        <div style="margin-top: 10px; color: var(--primary); font-weight: 600; text-align: center;">
          Duration: ${diffDays} days
        </div>
      </div>
      <div class="calendar-days">
        <div class="calendar-day weekday">Mon</div>
        <div class="calendar-day weekday">Tue</div>
        <div class="calendar-day weekday">Wed</div>
        <div class="calendar-day weekday">Thu</div>
        <div class="calendar-day weekday">Fri</div>
        <div class="calendar-day weekday">Sat</div>
        <div class="calendar-day weekday">Sun</div>
        ${generateCalendarDays(start, due)}
      </div>
    `;
  }
  
  function generateCalendarDays(start, due) {
    let html = '';
    const today = new Date();
    
    // Create 42 days (6 weeks) starting from Monday before start date
    const firstDay = new Date(start);
    firstDay.setDate(firstDay.getDate() - firstDay.getDay() + 1); // Get Monday
    
    for (let i = 0; i < 42; i++) {
      const currentDay = new Date(firstDay);
      currentDay.setDate(firstDay.getDate() + i);
      
      const isStart = currentDay.toDateString() === start.toDateString();
      const isDue = currentDay.toDateString() === due.toDateString();
      const isProjectDay = currentDay >= start && currentDay <= due;
      const isToday = currentDay.toDateString() === today.toDateString();
      
      let className = 'calendar-day';
      if (isStart || isDue) className += ' active';
      
      html += `<div class="${className}" style="${isProjectDay ? 'background: var(--primary-light);' : ''} ${isToday ? 'border: 2px solid var(--primary);' : ''}">
        ${currentDay.getDate()}
      </div>`;
    }
    
    return html;
  }
  
  startDateInput.addEventListener('change', updateCalendarPreview);
  dueDateInput.addEventListener('change', updateCalendarPreview);

  // Handle delete button click for projects
  function handleDelete(event) {
    const projectId = event.target.closest('.btn-delete').getAttribute('data-id');
    currentProjectId = projectId;
    deleteModal.style.display = 'flex';
  }

  // Handle edit button click for projects
  function handleEdit(event) {
    const projectId = event.target.closest('.btn-edit').getAttribute('data-id');
    currentProjectId = projectId;
    isEditMode = true;
    
    // Load project data for editing
    loadProjectForEdit(projectId);
  }

  // Load project data for editing
  async function loadProjectForEdit(projectId) {
    try {
      // Check if Airtable credentials are provided
      if (!AIRTABLE_BASE_ID || !AIRTABLE_API_KEY || 
          AIRTABLE_BASE_ID === "YOUR_BASE_ID" || 
          AIRTABLE_API_KEY === "YOUR_API_KEY") {
        alert('Airtable not configured. Cannot load project for editing.');
        return;
      }

      const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_PROJECTS_TABLE}/${projectId}`, {
        headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` }
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      const project = data.fields;
      
      // Populate form with project data
      document.getElementById('projectName').value = project['Project Name'] || '';
      document.getElementById('projectType').value = project['Project Type'] || '';
      document.getElementById('projectDescription').value = project['Project Description'] || '';
      document.getElementById('companyName').value = project['Company Name'] || '';
      document.getElementById('clientName').value = project['Client Name'] || '';
      document.getElementById('clientEmail').value = project['Client Email'] || '';
      document.getElementById('clientPhone').value = project['Client Phone'] || '';
      document.getElementById('startDate').value = project['Start Date'] || '';
      document.getElementById('dueDate').value = project['Due Date'] || '';
      document.getElementById('projectProgress').value = project['Progress'] || '0';
      document.getElementById('projectStatus').value = project['Status'] || 'active';
      document.getElementById('projectBudget').value = project['Budget'] || '';
      document.getElementById('milestones').value = project['Milestones'] || '';
      document.getElementById('projectNotes').value = project['Notes'] || '';
      
      // Set project number
      currentProjectNumber = project['Project ID'] || '';
      document.getElementById('projectNumberDisplay').textContent = currentProjectNumber;
      
      // Update progress bar
      progressValue.textContent = project['Progress'] || '0' + '%';
      progressBar.style.width = (project['Progress'] || '0') + '%';
      
      // Update calendar
      updateCalendarPreview();
      
      // Update assigned managers
      if (project['Assigned Managers']) {
        selectedManagers = project['Assigned Managers'].split(',').map(id => id.trim());
        initializeManagers();
      }
      
      // Update form title and button
      projectFormTitle.textContent = 'Edit Project';
      saveProjectBtn.innerHTML = '<i class="fas fa-save"></i> Update Project';
      
      // Navigate to create project page
      navigateToPage('createProjectPage', 'Edit Project');
      
    } catch(error) {
      console.error('Error loading project for editing:', error);
      alert('Error loading project for editing: ' + error.message);
    }
  }

  // Reset project form
  function resetProjectForm() {
    document.getElementById('projectForm').reset();
    document.getElementById('projectProgress').value = 0;
    progressValue.textContent = '0%';
    progressBar.style.width = '0%';
    selectedManagers = [];
    document.getElementById('assignedManagers').value = '';
    initializeManagers();
    updateCalendarPreview();
    getNextProjectNumber();
    currentProjectId = null;
    isEditMode = false;
  }

  // Handle delete confirmation
  confirmDelete.addEventListener('click', async function() {
    try {
      // Check if Airtable credentials are provided
      if (!AIRTABLE_BASE_ID || !AIRTABLE_API_KEY || 
          AIRTABLE_BASE_ID === "YOUR_BASE_ID" || 
          AIRTABLE_API_KEY === "YOUR_API_KEY") {
        alert('Project deleted locally! (Airtable not configured)');
        deleteModal.style.display = 'none';
        if (currentProjectId) {
          loadProjectsFromAirtable();
        }
        return;
      }

      const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_PROJECTS_TABLE}/${currentProjectId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${AIRTABLE_API_KEY}`
        }
      });
      
      if (response.ok) {
        alert('Project deleted successfully!');
        deleteModal.style.display = 'none';
        if (currentProjectId) {
          loadProjectsFromAirtable();
          currentProjectId = null;
        }
      } else {
        const result = await response.json();
        alert('Error: ' + result.error.message);
      }
    } catch(error) {
      alert('Network error: ' + error.message);
    }
  });

  // Close delete modal
  closeDeleteModal.addEventListener('click', function() {
    deleteModal.style.display = 'none';
  });
  
  cancelDelete.addEventListener('click', function() {
    deleteModal.style.display = 'none';
  });

  // Close modal when clicking outside
  window.addEventListener('click', function(event) {
    if (event.target === deleteModal) {
      deleteModal.style.display = 'none';
    }
  });

  // Load projects from Airtable
  async function loadProjectsFromAirtable() {
    const projectsTableBody = document.getElementById('projectsTableBody');
    
    try {
      // Check if Airtable credentials are provided
      if (!AIRTABLE_BASE_ID || !AIRTABLE_API_KEY || 
          AIRTABLE_BASE_ID === "YOUR_BASE_ID" || 
          AIRTABLE_API_KEY === "YOUR_API_KEY") {
        projectsTableBody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray-500);">
              <i class="fas fa-cloud" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
              <p>Airtable not configured. <a href="#" style="color: var(--primary);" id="createFirstProject2">Create your first project</a></p>
            </td>
          </tr>
        `;
        document.getElementById('createFirstProject2').addEventListener('click', function(e) {
          e.preventDefault();
          resetProjectForm();
          projectFormTitle.textContent = 'Create New Project';
          saveProjectBtn.innerHTML = '<i class="fas fa-save"></i> Save Project';
          isEditMode = false;
          navigateToPage('createProjectPage', 'Create Project');
        });
        return;
      }

      const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_PROJECTS_TABLE}?pageSize=100`, {
        headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` }
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      
      if (!data.records || data.records.length === 0) {
        projectsTableBody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray-500);">
              <i class="fas fa-project-diagram" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
              <p>No projects found. <a href="#" style="color: var(--primary);" id="createFirstProject3">Create your first project</a></p>
            </td>
          </tr>
        `;
        document.getElementById('createFirstProject3').addEventListener('click', function(e) {
          e.preventDefault();
          resetProjectForm();
          projectFormTitle.textContent = 'Create New Project';
          saveProjectBtn.innerHTML = '<i class="fas fa-save"></i> Save Project';
          isEditMode = false;
          navigateToPage('createProjectPage', 'Create Project');
        });
        return;
      }

      // Populate table with projects
      projectsTableBody.innerHTML = data.records.map(record => {
        const fields = record.fields;
        const statusClass = `status-${(fields.Status || 'active').toLowerCase().replace(' ', '-')}`;
        const progress = fields.Progress || 0;
        
        return `
          <tr>
            <td><strong>${fields['Project ID'] || 'N/A'}</strong></td>
            <td><strong>${fields['Project Name'] || 'N/A'}</strong></td>
            <td>${fields['Client Name'] || 'N/A'}</td>
            <td>${fields['Start Date'] || 'N/A'}</td>
            <td>${fields['Due Date'] || 'N/A'}</td>
            <td>
              <div class="progress-bar-container" style="margin: 5px 0;">
                <div class="progress-bar" style="width: ${progress}%"></div>
              </div>
              <div style="text-align: center; font-size: 12px; font-weight: 600;">${progress}%</div>
            </td>
            <td><span class="status-badge ${statusClass}">${fields.Status || 'Active'}</span></td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-sm btn-view" data-id="${record.id}">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-sm btn-edit" data-id="${record.id}">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-sm btn-delete" data-id="${record.id}">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
      
      // Add event listeners to buttons
      document.querySelectorAll('.btn-view').forEach(btn => {
        btn.addEventListener('click', function() {
          const projectId = this.getAttribute('data-id');
          alert('View project details for ID: ' + projectId);
          // In a real app, you would navigate to a project details page
        });
      });
      
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', handleEdit);
      });
      
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', handleDelete);
      });
      
    } catch(error) {
      console.error('Error loading projects:', error);
      projectsTableBody.innerHTML = `
        <tr>
          <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray-500);">
            <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
            <p>Error loading projects. <a href="#" style="color: var(--primary);" id="createFirstProject4">Create your first project</a></p>
          </td>
        </tr>
      `;
      document.getElementById('createFirstProject4').addEventListener('click', function(e) {
        e.preventDefault();
        resetProjectForm();
        projectFormTitle.textContent = 'Create New Project';
        saveProjectBtn.innerHTML = '<i class="fas fa-save"></i> Save Project';
        isEditMode = false;
        navigateToPage('createProjectPage', 'Create Project');
      });
    }
  }

  // Get next project number
  async function getNextProjectNumber() {
    try {
      // Check if Airtable credentials are provided
      if (!AIRTABLE_BASE_ID || !AIRTABLE_API_KEY || 
          AIRTABLE_BASE_ID === "YOUR_BASE_ID" || 
          AIRTABLE_API_KEY === "YOUR_API_KEY") {
        console.warn('Airtable credentials not configured. Using default project number.');
        document.getElementById('projectNumberDisplay').textContent = 'PROJ-001';
        return 'PROJ-001';
      }

      const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_PROJECTS_TABLE}?pageSize=100`, {
        headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` }
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      
      // Check if data.records exists and is an array
      if (!data.records || !Array.isArray(data.records)) {
        console.warn('No records found or invalid response structure. Using default project number.');
        document.getElementById('projectNumberDisplay').textContent = 'PROJ-001';
        return 'PROJ-001';
      }
      
      const existingNumbers = data.records.map(r => {
        // Safely access the project ID field
        const projectId = r.fields ? r.fields['Project ID'] : null;
        if (projectId && projectId.startsWith('PROJ-')) {
          const num = projectId.split('-')[1];
          return num ? parseInt(num) : 0;
        }
        return 0;
      }).filter(n => !isNaN(n) && n > 0).sort((a,b) => a - b);
      
      let nextNum = 1;
      for (let n of existingNumbers) {
        if (n === nextNum) nextNum++; 
        else break;
      }
      
      const projectNumber = `PROJ-${String(nextNum).padStart(3,'0')}`;
      document.getElementById('projectNumberDisplay').textContent = projectNumber;
      return projectNumber;
      
    } catch(e){ 
      console.error('Error fetching project number:', e); 
      // Fallback to a default number
      document.getElementById('projectNumberDisplay').textContent = 'PROJ-001';
      return 'PROJ-001'; 
    }
  }

  // Submit project to Airtable
  const projectForm = document.getElementById('projectForm');
  
  projectForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const projectNumber = isEditMode ? currentProjectNumber : await getNextProjectNumber();

    // Create project data
    const projectData = {
      fields: {
        "Project ID": projectNumber,
        "Project Name": projectForm.projectName.value,
        "Project Type": projectForm.projectType.value,
        "Project Description": projectForm.projectDescription.value,
        "Company Name": projectForm.companyName.value,
        "Client Name": projectForm.clientName.value,
        "Client Email": projectForm.clientEmail.value,
        "Client Phone": projectForm.clientPhone.value,
        "Start Date": projectForm.startDate.value,
        "Due Date": projectForm.dueDate.value,
        "Progress": projectForm.projectProgress.value,
        "Status": projectForm.projectStatus.value,
        "Budget": projectForm.projectBudget.value || 0,
        "Milestones": projectForm.milestones.value,
        "Notes": projectForm.projectNotes.value,
        "Assigned Managers": selectedManagers.join(',')
      }
    };

    console.log("Sending project data:", projectData);

    try {
      // Check if Airtable credentials are provided before trying to save
      if (!AIRTABLE_BASE_ID || !AIRTABLE_API_KEY || 
          AIRTABLE_BASE_ID === "YOUR_BASE_ID" || 
          AIRTABLE_API_KEY === "YOUR_API_KEY") {
        alert(`Project ${projectNumber} ${isEditMode ? 'updated' : 'created'} locally! (Airtable not configured)`);
        resetProjectForm();
        navigateToPage('projectsPage', 'Projects');
        return;
      }

      const url = isEditMode 
        ? `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_PROJECTS_TABLE}/${currentProjectId}`
        : `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_PROJECTS_TABLE}`;
      
      const method = isEditMode ? 'PATCH' : 'POST';
      
      const response = await fetch(url, {
        method: method,
        headers: {
          'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(projectData)
      });
      
      const result = await response.json();
      console.log("Airtable response:", result);
      
      if(response.ok){ 
        alert(`Project ${projectNumber} ${isEditMode ? 'updated' : 'saved'} to Airtable!`); 
        resetProjectForm();
        navigateToPage('projectsPage', 'Projects');
        loadProjectsFromAirtable(); // Refresh the list
      } 
      else {
        alert('Error: '+ result.error.message);
      }
    } catch(error){ 
      console.error("Network error:", error);
      alert('Network error: '+error.message); 
    }
  });

  // Auto-fill client email based on company
  document.getElementById('companyName').addEventListener('change', function() {
    const company = this.value;
    const clientEmail = document.getElementById('clientEmail');
    
    if (company && !clientEmail.value) {
      switch(company) {
        case 'mozilla':
          clientEmail.value = 'contact@mozilla.com';
          break;
        case 'google':
          clientEmail.value = 'contact@google.com';
          break;
        case 'microsoft':
          clientEmail.value = 'contact@microsoft.com';
          break;
        case 'apple':
          clientEmail.value = 'contact@apple.com';
          break;
        default:
          clientEmail.value = '';
      }
    }
  });

  // Initialize managers and progress bar on page load
  initializeManagers();
  
  // Set default dates
  const today = new Date();
  const nextWeek = new Date();
  nextWeek.setDate(today.getDate() + 7);
  
  document.getElementById('startDate').valueAsDate = today;
  document.getElementById('dueDate').valueAsDate = nextWeek;
  
  // Update calendar preview
  setTimeout(updateCalendarPreview, 100);

  // Start with Projects page active
  navigateToPage('projectsPage', 'Projects');
});
</script>

</body>
</html>