<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Invoice System</title>
<style>
/* ---------- Global Styles ---------- */
body {
  font-family: 'Inter', 'Segoe UI', Tahoma, sans-serif;
  background: #f0f4f8; /* Soft light background */
  margin: 0;
  padding: 0;
  color: #1a1a1a; /* Dark text for readability */
}

.container {
  max-width: 960px;
  margin: 50px auto;
  background: #ffffff;
  border-radius: 20px;
  box-shadow: 0 16px 40px rgba(0,0,0,0.08);
  padding: 60px 70px;
  transition: all 0.3s ease;
}

.container:hover {
  box-shadow: 0 20px 50px rgba(0,0,0,0.12);
}

img.logo {
  display: block;
  margin: 0 auto 30px auto;
  width: 120px;
}

/* ---------- Headings ---------- */
h2 {
  text-align: center;
  color: #0056ff; /* Modern Blue */
  font-size: 34px;
  font-weight: 700;
  margin-bottom: 30px;
}

.section-title {
  font-weight: 700;
  font-size: 20px;
  color: #222;
  margin: 40px 0 20px 0;
  padding-bottom: 8px;
  border-bottom: 2px solid #e2e8f0;
}

/* ---------- Form Inputs ---------- */
input, textarea, select {
  width: 100%;
  padding: 15px 18px;
  margin-bottom: 16px;
  border-radius: 12px;
  border: 1px solid #cbd5e1;
  font-size: 15px;
  transition: all 0.3s ease;
}

input:focus, textarea:focus, select:focus {
  border-color: #0056ff;
  box-shadow: 0 0 0 4px rgba(0, 86, 255, 0.15);
  outline: none;
}

/* ---------- Buttons ---------- */
button {
  padding: 14px 24px;
  border-radius: 12px;
  border: none;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

button:hover {
  opacity: 0.9;
}

#addItem {
  background: #0056ff;
  color: #fff;
  margin-bottom: 30px;
}

.removeBtn {
  background: #ff4d4f;
  color: #fff;
  padding: 10px 16px;
  border-radius: 10px;
}

#downloadPdf, button[type="submit"] {
  background: #0056ff;
  color: #fff;
  margin-top: 20px;
}

/* ---------- Table Styles ---------- */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 14px;
  margin-top: 20px;
  table-layout: auto;
}

table thead tr {
  background: #f1f5f9;
  border-radius: 12px;
}

table th {
  padding: 16px 14px;
  text-align: left;
  font-weight: 600;
  color: #1a1a1a;
}

table tbody tr {
  background: #ffffff;
  box-shadow: 0 4px 16px rgba(0,0,0,0.06);
  border-radius: 12px;
  transition: background 0.3s ease, transform 0.2s ease;
}

table tbody tr:hover {
  background: #e6f0ff;
  transform: translateY(-2px);
}

table td {
  padding: 14px 12px;
  vertical-align: middle;
}

table input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #cbd5e1;
  font-size: 14px;
}

table td:last-child {
  text-align: center;
}

/* ---------- Responsive ---------- */
@media (max-width: 768px) {
  .container {
    padding: 40px 25px;
  }
  table th, table td {
    font-size: 13px;
    padding: 10px 8px;
  }
  table input {
    padding: 8px 10px;
    font-size: 13px;
  }
  h2 {
    font-size: 28px;
  }
  .section-title {
    font-size: 18px;
  }
}


</style>
</head>
<body>

<div class="container">
<img src="c:\Users\mozil\Downloads\moz logo (1).png" alt="Company Logo" class="logo">
<h2>Mozillio</h2>
<h2>Create Invoice</h2>

<form id="invoiceForm">
  <div class="top-section">
  <div class="box">
  <div class="section-title">Invoice Details</div>
  <input type="date" name="date" placeholder="Date" required>
  <input type="text" name="validity" placeholder="Validity" required>
  <input type="text" name="companyName" placeholder="Company Name" required>
</div>
  <div class="section-title">Client Details</div>
   <div class="box">
  <input type="text" name="clientName" placeholder="Client Name" required>
  <input type="email" name="clientEmail" placeholder="Client Email" required>
  <textarea name="clientAddress" placeholder="Client Address" required></textarea>
</div>
  <div class="section-title">Project Details</div>
  <input type="text" name="projectName" placeholder="Project Name" required>
  <textarea name="projectDescription" placeholder="Project Description" required></textarea>

  <div class="section-title">Items</div>
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Service/Item</th>
        <th>Description</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Total</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="text" name="itemName[]" required></td>
        <td><input type="text" name="itemDescription[]" required></td>
        <td><input type="number" name="itemQty[]" min="1" value="1" required></td>
        <td><input type="number" name="itemPrice[]" min="0" step="0.01" value="0" required></td>
        <td><input type="number" name="itemTotal[]" value="0" readonly></td>
        <td><button type="button" class="removeBtn">Remove</button></td>
      </tr>
    </tbody>
  </table>
  <button type="button" id="addItem">Add Item</button>

  <div class="section-title">Totals</div>
  

<label for="subtotal">Subtotal</label>
<input type="number" id="subtotal" name="subtotal" placeholder="Subtotal" readonly>

<label for="discount">Discount</label>
<input type="number" id="discount" name="discount" placeholder="Discount" value="0" step="0.01">

<label for="tax">Tax (6%)</label>
<input type="number" id="tax" name="tax" placeholder="Tax (6%)" readonly>

<label for="total">Total</label>
<input type="number" id="total" name="total" placeholder="Total" readonly>

  <div class="section-title">Other Details</div>
  <textarea name="paymentTerms" placeholder="Payment Terms"></textarea>
  <input type="text" name="deliveryTimeline" placeholder="Delivery Timeline">
  <select name="status">
    <option value="Draft">Draft</option>
    <option value="Sent">Sent</option>
    <option value="Paid">Paid</option>
  </select>

  <button type="submit">Save Invoice</button>
  <button type="button" id="downloadPdf">Download PDF</button>
</form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
// Airtable config
const AIRTABLE_BASE_ID = "app6jM5rj5GDbVvCI";
const AIRTABLE_API_KEY = "YOUR_API_KEY_HERE";
const AIRTABLE_TABLE_NAME = "Invoices";

const invoiceForm = document.getElementById('invoiceForm');
const addItemBtn = document.getElementById('addItem');
const itemsTable = document.getElementById('itemsTable').getElementsByTagName('tbody')[0];
const subtotalInput = document.getElementById('subtotal');
const discountInput = document.getElementById('discount');
const taxInput = document.getElementById('tax');
const totalInput = document.getElementById('total');

// Dynamic items & totals
function calculateTotals() {
  let subtotal = 0;
  const rows = itemsTable.querySelectorAll('tr');
  rows.forEach(row => {
    const qty = parseFloat(row.querySelector('input[name="itemQty[]"]').value) || 0;
    const price = parseFloat(row.querySelector('input[name="itemPrice[]"]').value) || 0;
    const total = qty * price;
    row.querySelector('input[name="itemTotal[]"]').value = total.toFixed(2);
    subtotal += total;
  });

  subtotalInput.value = subtotal.toFixed(2);
  const discount = parseFloat(discountInput.value) || 0;
  const taxableAmount = subtotal - discount;
  const tax = +(taxableAmount * 0.06).toFixed(2); // 6% fixed
  taxInput.value = tax;
  totalInput.value = (taxableAmount + tax).toFixed(2);
}

itemsTable.addEventListener('input', calculateTotals);
itemsTable.addEventListener('click', function(e){
  if(e.target.classList.contains('removeBtn')){
    e.target.closest('tr').remove();
    calculateTotals();
  }
});
addItemBtn.addEventListener('click', () => {
  const row = document.createElement('tr');
  row.innerHTML = `
    <td><input type="text" name="itemName[]" required></td>
    <td><input type="text" name="itemDescription[]" required></td>
    <td><input type="number" name="itemQty[]" min="1" value="1" required></td>
    <td><input type="number" name="itemPrice[]" min="0" step="0.01" value="0" required></td>
    <td><input type="number" name="itemTotal[]" value="0" readonly></td>
    <td><button type="button" class="removeBtn">Remove</button></td>
  `;
  itemsTable.appendChild(row);
});
discountInput.addEventListener('input', calculateTotals);
calculateTotals();

// Next Invoice Number (consecutive)
async function getNextInvoiceNumber() {
  try {
    const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?pageSize=100`, {
      headers: { 'Authorization': `Bearer ${AIRTABLE_API_KEY}` }
    });
    const data = await response.json();
    const existingNumbers = data.records.map(r => {
      const num = r.fields['Invoice Number']?.split('-')[1];
      return num ? parseInt(num) : 0;
    }).sort((a,b)=>a-b);
    let nextNum = 1;
    for (let n of existingNumbers) if(n===nextNum) nextNum++; else break;
    return `MOZ-${String(nextNum).padStart(3,'0')}`;
  } catch(e){ console.error(e); return 'MOZ-001'; }
}

// Submit to Airtable
invoiceForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const invoiceNumber = await getNextInvoiceNumber();

  // Gather items
  const itemNames = [...document.getElementsByName('itemName[]')].map(i=>i.value);
  const itemDescriptions = [...document.getElementsByName('itemDescription[]')].map(i=>i.value);
  const itemQtys = [...document.getElementsByName('itemQty[]')].map(i=>parseFloat(i.value));
  const itemPrices = [...document.getElementsByName('itemPrice[]')].map(i=>parseFloat(i.value));

  const invoiceData = {
    fields: {
      "Date": invoiceForm.date.value,
      "Invoice Number": invoiceNumber,
      "Validity": invoiceForm.validity.value,
      "Company Name": invoiceForm.companyName.value,
      "Client Name": invoiceForm.clientName.value,
      "Client Email": invoiceForm.clientEmail.value,
      "Client Address": invoiceForm.clientAddress.value,
      "Project Name": invoiceForm.projectName.value,
      "Project Description": invoiceForm.projectDescription.value,
      "Item Names": itemNames.join(", "),
      "Item Descriptions": itemDescriptions.join(", "),
      "Item Quantities": itemQtys.join(", "),
      "Item Prices": itemPrices.join(", "),
      "Subtotal": parseFloat(subtotalInput.value),
      "Discount": parseFloat(discountInput.value) || 0,
      "Tax": parseFloat(taxInput.value),
      "Total": parseFloat(totalInput.value),
      "Payment Terms": invoiceForm.paymentTerms.value,
      "Delivery Timeline": invoiceForm.deliveryTimeline.value,
      "Status": invoiceForm.status.value
    }
  };

  try {
    const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(invoiceData)
    });
    const result = await response.json();
    if(response.ok){ alert(`Invoice ${invoiceNumber} saved!`); invoiceForm.reset(); calculateTotals(); } 
    else alert('Error: '+ result.error.message);
  } catch(error){ alert('Network error: '+error.message); }
});

document.getElementById('downloadPdf').addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","pt","a4");

  let y = 40;

  // Title
  doc.setFontSize(22);
  doc.setFont("helvetica","bold");
  doc.text("INVOICE", 300, y, {align:"center"});
  y += 40;

  // Separator
  doc.setLineWidth(1);
  doc.line(40, y, 555, y);
  y += 25;

  doc.setFontSize(12);
  doc.setFont("helvetica","");

  doc.text(`Date: ${invoiceForm.date.value}`, 40, y); y += 18;
  doc.text(`Invoice Number: MOZ-XXX`, 40, y); y += 18;
  doc.text(`Validity: ${invoiceForm.validity.value}`, 40, y); y += 18;
  doc.text(`Company Name: ${invoiceForm.companyName.value}`, 40, y); y += 30;

  doc.setFont("helvetica","bold");
  doc.text("Client Details", 40, y); y += 15;
  doc.setFont("helvetica","");
  doc.text(`Name: ${invoiceForm.clientName.value}`, 40, y); y += 15;
  doc.text(`Email: ${invoiceForm.clientEmail.value}`, 40, y); y += 15;
  doc.text(`Address: ${invoiceForm.clientAddress.value}`, 40, y); y += 30;

  doc.setFont("helvetica","bold");
  doc.text("Project Details", 40, y); y += 15;
  doc.setFont("helvetica","");
  doc.text(`Project Name: ${invoiceForm.projectName.value}`, 40, y); y += 15;
  doc.text(`Description: ${invoiceForm.projectDescription.value}`, 40, y); y += 30;

  // ITEMS TABLE
  doc.setFont("helvetica","bold");
  doc.text("Items", 40, y); y += 20;

  doc.setFontSize(11);

  const rows = itemsTable.querySelectorAll('tr');

  rows.forEach((row,i)=>{
    doc.setFont("helvetica","bold");
    doc.text(`Item ${i+1}`, 40, y);
    y += 14;

    doc.setFont("helvetica","");
    doc.text(`Service: ${row.querySelector('input[name="itemName[]"]').value}`, 55, y); y += 14;
    doc.text(`Description: ${row.querySelector('input[name="itemDescription[]"]').value}`, 55, y); y += 14;
    doc.text(`Qty: ${row.querySelector('input[name="itemQty[]"]').value} | Price: ${row.querySelector('input[name="itemPrice[]"]').value} | Total: ${row.querySelector('input[name="itemTotal[]"]').value}`, 55, y);
    y += 22;

    doc.setLineWidth(0.5);
    doc.line(40, y, 555, y);
    y += 12;
  });

  y += 15;
  doc.setFontSize(12);
  doc.setFont("helvetica","bold");
  doc.text("Summary", 40, y); y += 18;

  doc.setFont("helvetica","");
  doc.text(`Subtotal: ${subtotalInput.value}`, 40, y); y += 16;
  doc.text(`Discount: ${discountInput.value}`, 40, y); y += 16;
  doc.text(`Tax (6%): ${taxInput.value}`, 40, y); y += 16;
  doc.setFont("helvetica","bold");
  doc.text(`TOTAL: ${totalInput.value}`, 40, y);

  doc.save(`Invoice-${invoiceForm.clientName.value}.pdf`);
});

</script>

</body>
</html>
